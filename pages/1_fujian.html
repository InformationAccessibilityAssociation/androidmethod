<!DOCTYPE html>

<html lang="zh-CN">
<head>
<title>附件1</title>
<link rel="stylesheet" href="../style.css" />
<meta charset="utf-8">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.zclip.min.js"></script>
<script type="text/javascript">
$(function(){ 
    $('#copy_input1').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code1').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 
$(function(){ 
    $('#copy_input2').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code2').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 
</script>
</head>
<body>
<div class="wrap">
<!-- header begin -->
<div class="header">
    <div ><a href="http://www.siaa.org.cn/"><img src="../logo.png" alt="信息无障碍研究会"  class="logo"/></a></div>
    <!-- nav bar begin -->
    <div class="nav-bar">
        <!-- nav menu begin -->
        <ul>
            <li><a href="index.html">首页</a></li>
            <li><a href="1_zhengzebiaoqing.html">返回</a></li>
        </ul>
        <!-- nav menu end -->
    </div>
    <!-- nav bar end -->
</div>
<!-- header end -->

<!-- body begin -->
<div class="body">
    <h3>附件1----已正则表达式替代方式展示表情</h3>
    <hr />
    <div>
        <h4>1、</h4>
        <hr />
        <p>在res/values/下创建arrays.xml，并添加下面定义表情的array，/::wx、/::dk等就代表表情字段，可以自己定义，这就是到时候发表表情时真正的东西（代表对应的表情图片）。</p><!--问题说明-->
		<textarea rows="12" cols="120">
<?xml version="1.0" encoding="utf-8"?>
<resources 
    xmlns:android="http://schemas.android.com/apk/res/android" 
    xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">    
   <string-array name="smiley_array">    
        <!--有几种表情就写几个item......-->
        <item>/::wx</item>
        <item>/::dk</item>
        <item>/::zd</item>
		<item>/::kl</item>
		<item>/::gx</item>
    </string-array>    
</resources>  
		</textarea>
    </div>
	
	<div>
        <h4>2、</h4>
        <hr />
        <p>将自己要用的表情图片放入res/drawable/下;</p><!--问题说明-->
    </div>
	
	<div>
        <h4>3、</h4>
        <hr />
        <p>将下面工具类拷入自己的工程里。（根据自己资源的名称还需要进行稍微修改）。</p><!--问题说明-->
		<textarea rows="20" cols="120">
import android.content.Context;    
import android.graphics.drawable.Drawable;    
import android.text.Spannable;    
import android.text.SpannableStringBuilder;    
import android.text.style.ImageSpan;    
import java.util.HashMap;    
import java.util.regex.Matcher;    
import java.util.regex.Pattern;    

public class SmileyParser {    
    private static SmileyParser sInstance;    

    public static SmileyParser getInstance() {    
        return sInstance;    
    }    

    public static void init(Context context) {    
        sInstance = new SmileyParser(context);    
    }    

    private final Context mContext;    
    private final String[] mSmileyTexts;    
    private final Pattern mPattern;    
    private final HashMap<String, Integer> mSmileyToRes;    

    private SmileyParser(Context context) {    
        mContext = context;    
        mSmileyTexts = mContext.getResources().getStringArray(    
                DEFAULT_SMILEY_TEXTS);    
        mSmileyToRes = buildSmileyToRes();    
        mPattern = buildPattern();    
    }    

    static class Smileys {    
        // 表情图片集合    
        private static final int[] sIconIds = { R.drawable.image0,    
                R.drawable.image1, R.drawable.image2,    
                R.drawable.image3, R.drawable.image4};    
        // 将图片映射为 文字    
        public static int dk = 0;    
        public static int dx = 1;    
        public static int hx = 2;    
        public static int hy = 3;    
        public static int jy = 4;    

        // 得到图片表情 根据id    
        public static int getSmileyResource(int which) {    
            return sIconIds[which];    
        }    
    }    

    public static final int[] DEFAULT_SMILEY_RES_IDS = {    
            Smileys.getSmileyResource(Smileys.dk), // 0    
            Smileys.getSmileyResource(Smileys.dx), // 1    
            Smileys.getSmileyResource(Smileys.hx), // 2    
            Smileys.getSmileyResource(Smileys.hy), // 3    
            Smileys.getSmileyResource(Smileys.jy), // 4    
    };    

        public static final int DEFAULT_SMILEY_TEXTS = R.array.smiley_array;    
    	private HashMap<String, Integer> buildSmileyToRes() {    
        if (DEFAULT_SMILEY_RES_IDS.length != mSmileyTexts.length) {    
            throw new IllegalStateException("Smiley resource ID/text mismatch");    
        }    
        HashMap<String, Integer> smileyToRes = new HashMap<String, Integer>(    
                mSmileyTexts.length);    
        for (int i = 0; i < mSmileyTexts.length; i++) {    
            smileyToRes.put(mSmileyTexts[i], DEFAULT_SMILEY_RES_IDS[i]);    
        }    
        return smileyToRes;    
    }    

    // 构建正则表达式    
    private Pattern buildPattern() {    
        StringBuilder patternString = new StringBuilder(mSmileyTexts.length * 3);    
        patternString.append('(');    
        for (String s : mSmileyTexts) {    
            patternString.append(Pattern.quote(s));    
            patternString.append('|');    
        }    
        patternString.replace(patternString.length() - 1, patternString    
                .length(), ")");    
        return Pattern.compile(patternString.toString());    
    }    

    // 根据文本替换成图片    
    public CharSequence strToSmiley(CharSequence text) {    
        SpannableStringBuilder builder = new SpannableStringBuilder(text);    
        Matcher matcher = mPattern.matcher(text);    
        while (matcher.find()) {    
            int resId = mSmileyToRes.get(matcher.group());    
            Drawable drawable = mContext.getResources().getDrawable(resId);    
            drawable.setBounds(0, 0, 25, 25);//这里设置图片的大小    
            ImageSpan imageSpan = new ImageSpan(drawable, ImageSpan.ALIGN_BOTTOM);    
            builder.setSpan(imageSpan, matcher.start(),    
                    matcher.end(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);    
        }    
        return builder;    
    }    
}  
		</textarea>
    </div>
	
	<div>
        <h4>4、最后就是怎么使用了</h4>
        <hr />
        <p>（1）初始化  </p><!--问题说明-->
		<textarea rows="4" cols="120">
SmileyParser.init(this);    
SmileyParse SmileyParse;
smileyParser = SmileyParser.getInstance();//进行初始化    
		</textarea>
		<p>（2）最后的使用  </p><!--问题说明-->
		<textarea rows="7" cols="120">
//faceStr代表表情字段，例如[XX]    
TextView myTextView;
String faceStr = "/::wx";
String newContent = myTextView.getText().toString() + faceStr;    
CharSequence replace = smileyParser.strToSmiley(newContent);    
myTextView.setText(replace);    
		</textarea>
    </div>	
	
	<div>
        <h4>5、</h4>
        <hr />
        <p>这样就可以看到自己的myEditText已经插入了对应的表情图片；</p><!--问题说明-->
	</div>
	
</div>
<!-- body end -->

<!-- footer begin -->
<div class="footer">
</div>
<!-- footer end -->
</div>
<!-- wrap end -->
</body>
</html>
