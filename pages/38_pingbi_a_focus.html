<!DOCTYPE html>

<html lang="zh-CN">
<head>
<title>屏蔽无障碍焦点（支持api 4）</title>
<link rel="stylesheet" href="../style.css" />
<meta charset="utf-8">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.zclip.min.js"></script>
<script type="text/javascript">
$(function(){ 
    $('#copy_input1').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code1').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 
$(function(){ 
    $('#copy_input2').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code2').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 
</script>
</head>
<body>
<div class="wrap">
<!-- header begin -->
<div class="header">
    <div ><a href="http://www.siaa.org.cn/"><img src="../logo.png" alt="信息无障碍研究会"  class="logo"/></a></div>
    <!-- nav bar begin -->
    <div class="nav-bar">
        <!-- nav menu begin -->
        <ul>
            <li><a href="../index.html">首页</a></li>
            <li><a href="../index.html">返回</a></li>
        </ul>
        <!-- nav menu end -->
    </div>
    <!-- nav bar end -->
</div>
<!-- header end -->

<!-- body begin -->
<div class="body">
    <h3>屏蔽无障碍焦点（支持api 4）____20160513</h3>
    <hr />
    <div>
        <h4>【问题描述】</h4>
        <hr />
        <p>一些背景图片、分隔符等不能操作没有什么实际意义的控件的焦点应该屏蔽，这样可以加快用焦点导航的用户浏览界面的速度，让用户更快的找到自己想操作的控件。在触摸屏用手势浏览的时候如果有大量的分隔符等没有意义的控件会导致用户滑动浏览的速度降低，影响用户使用产品的效率。</p><!--问题说明-->
    </div>
    <div>
        <h4>【问题代码】</h4>
        <hr />
        <p></p>
		<!--
        <textarea rows="14" cols="120" aria-label="问题代码" id="code1">

        </textarea><br/>
        <a href="#" id="copy_input1" class="copy">复制内容</a> 
		-->
    </div>
    <div>
        <h4>【问题解决方案描述】</h4>
        <hr />
        <p>屏蔽无障碍焦点虽然可以用<code>android:importantForAccessibility=”no“</code>，但是此属性有一个限制只能在api 16以上的系统生效。除了此属性可以做到屏蔽无障碍焦点之外，我们还可以使用<code>AccessibilityNodeInfo</code>类的<code>setVisibleToUser()</code>方法来屏蔽无障碍焦点，当调用<code>setVisibleToUser(true)</code>的时候表示此节点对用户不可见，那么屏幕阅读器就不会获得此控件的焦点。调用<code>setVisibleToUser(false)</code>代表此节点对用户可见，屏幕阅读器能获得此控件的焦点。标准控件可以添加<code>View.AccessibilityDelegate</code>之后重写<code>onInitializeAccessibilityNodeInfo()</code>方法在此方法中调用<code>AccessibilityNodeInfo.setVisibleToUser()</code>方法。自定义控件可以直接重写<code>onInitializeAccessibilityNodeInfo()</code>方法来调用此方法。如果想支持api 4可以使用v4包中的<code>AccessibilityNodeInfoCompat</code>和<code>View.AccessibilityDelegateCompat</code>达到此目的。<br/>
注：屏蔽焦点建议使用此方法，此方法同时可以屏蔽焦点导航设备的焦点，如键盘导航的焦点。
</p>
    </div>
    <div>
        <h4>【解决方案】</h4>
        <hr />
		<p>注：布局的代码请参看“<a href="#fujian1">附1</a>“。<br/>
下面的代码利用给标准控件添加<code>View.AccessibilityDelegate</code>把焦点屏蔽了。
</p>
        <textarea rows="45" cols="120" aria-label="解决方案代码" id="code2">
import android.app.Activity;
import android.os.Bundle;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.accessibility.AccessibilityNodeInfo;

public class MainActivity extends Activity {

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_toggle);
		//添加无障碍代理View.AccessibilityDelegate
		findViewById(R.id.image).setAccessibilityDelegate(mDelegate);
	}

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.toggle, menu);
		return true;
	}

	@Override
	public boolean onOptionsItemSelected(MenuItem item) {
		// Handle action bar item clicks here. The action bar will
		// automatically handle clicks on the Home/Up button, so long
		// as you specify a parent activity in AndroidManifest.xml.
		int id = item.getItemId();
		if (id == R.id.action_settings) {
			return true;
		}
		return super.onOptionsItemSelected(item);
	}

	//无障碍代理View.AccessibilityDelegate
	private View.AccessibilityDelegate mDelegate = new  View.AccessibilityDelegate() {
		@Override
		public void onInitializeAccessibilityNodeInfo (View host,AccessibilityNodeInfo info) {
			super.onInitializeAccessibilityNodeInfo(host, info);
			info.setVisibleToUser(false);
		}
	};
}
        </textarea><br/>
        <a href="#" id="copy_input2" class="copy">复制内容</a> 
    </div>
    <div>
        <h4>【前后效果图对比】</h4>
        <hr />
        <table>
            <tr>
                <td><img src="../images/38-1.png" class="litu" alt="" aria-labelledby="img1_label"/></td><!--<td><img src="../images/" class="litu" alt="" aria-labelledby="img2_label"/></td>-->
            </tr>
            <tr>
                <td id="img1_label">优化后，图像的焦点被屏蔽；</td>
				<!--
				<td id="img2_label"></td>
				-->
            </tr>
        </table>
    </div>
    <div>
        <h4>【扩展】</h4>
        <hr />
        <p></p>
    </div>
    <div>
        <h4>【更多】</h4>
        <hr />
		<a name="fujian1"><p >【附1】 布局文件代码</p></a>
		<textarea rows="25" cols="120" aria-label="问题代码" id="code1">
<LinearLayout
	xmlns:android="http://schemas.android.com/apk/res/android"
	android:layout_width="match_parent"
	android:layout_height="match_parent"
	android:orientation="vertical">

		<ImageView
			android:layout_width="wrap_content"
			android:layout_height="wrap_content"
			android:src="@drawable/ic_launcher"
			android:id="@+id/image"/>

		<Button
			android:layout_width="wrap_content"
			android:layout_height="wrap_content"
			android:text="测试"
			android:id="@+id/bt1"/>

		<Button
			android:layout_width="wrap_content"
			android:layout_height="wrap_content"
			android:text="停止测试"
			android:id="@+id/bt2"/>

</LinearLayout>
        </textarea><br/>
        <a href="#" id="copy_input1" class="copy">复制内容</a> 
    </div>
</div>
<!-- body end -->
<br/>
<hr/>
<!-- footer begin -->
<div class="footer">
<p class="copyright">深圳市信息无障碍研究会 版权所有.Copyright © 2016 ARA. All 
Rights Reserved. <a href="http://www.miibeian.gov.cn/" target="_blank">粤ICP备10065437号</a> </p>
<p class="copyright">地址：深圳市福田区雨田路1号富莲大厦一栋一层</p>
</div>
<!-- footer end -->
</div>
<!-- wrap end -->
</body>
</html>
