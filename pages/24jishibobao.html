<!DOCTYPE html>

<html lang="zh-CN">
<head>
<title>让无障碍服务及时播报控件的变化</title>
<link rel="stylesheet" href="../style.css" />
<meta charset="utf-8">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.zclip.min.js"></script>
<script type="text/javascript">
$(function(){ 
    $('#copy_input1').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code1').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 
$(function(){ 
    $('#copy_input2').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code2').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 
</script>
</head>
<body>
<div class="wrap">
<!-- header begin -->
<div class="header">
    <div ><a href="http://www.siaa.org.cn/"><img src="../logo.png" alt="信息无障碍研究会"  class="logo"/></a></div>
    <!-- nav bar begin -->
    <div class="nav-bar">
        <!-- nav menu begin -->
        <ul>
            <li><a href="../index.html">首页</a></li>
            <li><a href="../index.html">返回</a></li>
        </ul>
        <!-- nav menu end -->
    </div>
    <!-- nav bar end -->
</div>
<!-- header end -->

<!-- body begin -->
<div class="body">
    <h3>让无障碍服务及时播报控件的变化____20160517</h3>
    <hr />
    <div>
        <h4>【问题描述】</h4>
        <hr />
        <p>有时候控件的内容（text）、描述文本（contentDescription）等信息有变化的时候需要及时给用户播报。例如登录界面，用一个文本框（TextView）提示用户登录失败的原因，如：密码错误等。这时候错误信息就需要及时向用户播报，用户才能很快的知道登录错误的原因。</p><!--问题说明-->
    </div>
    <div>
        <h4>【问题代码】</h4>
        <hr />
        <p>当登录发生错误的时候错误信息会显示到id是result的TextView上，因为此控件没有设置及时播报出控件内容变化的属性，所以控件内容变化之后需要用户浏览到此控件才能知道错误原因。</p>
        <textarea rows="60" cols="120" aria-label="问题代码" id="code1">
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
	xmlns:android="http://schemas.android.com/apk/res/android"
	android:layout_width="match_parent"
	android:layout_height="match_parent"
	android:orientation="vertical">

	<LinearLayout
		android:layout_width="match_parent"
		android:layout_height="wrap_content"
		android:orientation="horizontal">

		<TextView
			android:layout_width="wrap_content"
			android:layout_height="wrap_content"
			android:text="用户名"/>

		<EditText
			android:layout_width="0dp"
			android:layout_weight="1"
			android:layout_height="wrap_content"
			android:hint="请在此处输入你的用户名"
			android:id="@+id/account"/>
	</LinearLayout>

	<LinearLayout
		android:layout_width="match_parent"
		android:layout_height="wrap_content"
		android:orientation="horizontal">

		<TextView
			android:layout_width="wrap_content"
			android:layout_height="wrap_content"
			android:text="密码"/>

		<EditText
			android:layout_width="0dp"
			android:layout_weight="1"
			android:layout_height="wrap_content"
			android:hint="用户密码"
			android:id="@+id/password"/>
	</LinearLayout>

	<LinearLayout
		android:layout_width="match_parent"
		android:layout_height="wrap_content"
		android:orientation="horizontal">

		<TextView
			android:layout_width="wrap_content"
			android:layout_height="wrap_content"
			android:id="@+id/result"/>

		<Button
			android:layout_width="0dp"
			android:layout_weight="1"
			android:layout_height="wrap_content"
			android:text="登录"
			android:id="@+id/login"/>
	</LinearLayout>
</LinearLayout>
        </textarea><br/>
        <a href="#" id="copy_input1" class="copy">复制内容</a> 
    </div>
    <div>
        <h4>【问题解决方案描述】</h4>
        <hr />
        <p>让控件能及时播报出控件内容、描述文本等其他信息的变化可以通过android:accessibilityLiveRegion属性，在代码中可以用setAccessibilityLiveRegion()方法设置此属性。此属性有3个可选值，分别是：none、polite、assertive。none是代表不及时播报内容的变化，此值是默认值。Polite是播报控件内容的变化，需要播报内容变化的时候建议使用此值。Assertive是代表打断其他所有的声音播报控件内容的变化，此属性一般用于播报特别紧急的控件内容变化。</p>
    </div>
    <div>
        <h4>【解决方案】</h4>
        <hr />
		<p>下面的代码中利用android:accessibilityLiveRegion属性让id为result的TextView控件的变化能及时播报出。</p>
        <textarea rows="60" cols="120" aria-label="解决方案代码" id="code2">
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
	xmlns:android="http://schemas.android.com/apk/res/android"
	android:layout_width="match_parent"
	android:layout_height="match_parent"
	android:orientation="vertical">

	<LinearLayout
		android:layout_width="match_parent"
		android:layout_height="wrap_content"
		android:orientation="horizontal">

		<TextView
			android:layout_width="wrap_content"
			android:layout_height="wrap_content"
			android:text="用户名"/>

		<EditText
			android:layout_width="0dp"
			android:layout_weight="1"
			android:layout_height="wrap_content"
			android:hint="请在此处输入你的用户名"
			android:id="@+id/account"/>
	</LinearLayout>

	<LinearLayout
		android:layout_width="match_parent"
		android:layout_height="wrap_content"
		android:orientation="horizontal">

		<TextView
			android:layout_width="wrap_content"
			android:layout_height="wrap_content"
			android:text="密码"/>

		<EditText
			android:layout_width="0dp"
			android:layout_weight="1"
			android:layout_height="wrap_content"
			android:hint="用户密码"
			android:id="@+id/password"/>
	</LinearLayout>

	<LinearLayout
		android:layout_width="match_parent"
		android:layout_height="wrap_content"
		android:orientation="horizontal">

		<TextView
			android:layout_width="wrap_content"
			android:layout_height="wrap_content"
			android:id="@+id/result"
			android:accessibilityLiveRegion="polite"/>

		<Button
			android:layout_width="0dp"
			android:layout_weight="1"
			android:layout_height="wrap_content"
			android:text="登录"
			android:id="@+id/login"/>
	</LinearLayout>
</LinearLayout>
        </textarea><br/>
        <a href="#" id="copy_input2" class="copy">复制内容</a> 
    </div>
    <div>
        <h4>【前后效果图对比】</h4>
        <hr />
        <table>
            <tr>
                <td><img src="../images/24-1.png" class="litu" alt="" aria-labelledby="img1_label"/></td><td><img src="../images/24-2.png" class="litu" alt="" aria-labelledby="img2_label"/></td>
            </tr>
            <tr>
                <td id="img1_label">优化前，用户名和密码为空时，点击登录，出现”用户名不能为空”的文本框，屏幕阅读器不会及时读出；</td><td id="img2_label">优化后，用户名和密码为空时，点击登录，出现”用户名不能为空”的文本框，屏幕阅读器及时读出” 用户名不能为空”；</td>
            </tr>
        </table>
    </div>
    <div>
        <h4>【扩展】</h4>
        <hr />
        <p>注：此功能永德android读屏不支持;</p>
    </div>
    <div>
        <h4>【更多】</h4>
        <hr />
        <ol></ol>
    </div>
</div>
<!-- body end -->

<!-- footer begin -->
<div class="footer">
</div>
<!-- footer end -->
</div>
<!-- wrap end -->
</body>
</html>
