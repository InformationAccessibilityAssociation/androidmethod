<!DOCTYPE html>

<html lang="zh-CN">
<head>
<title>用内容描述属性给标准的评分条添加说明和星级提示</title>
<link rel="stylesheet" href="../style.css" />
<meta charset="utf-8">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery.zclip.min.js"></script>
<script type="text/javascript">
$(function(){ 
    $('#copy_input1').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code1').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 
$(function(){ 
    $('#copy_input2').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code2').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 

$(function(){ 
    $('#copy_input3').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code3').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 
$(function(){ 
    $('#copy_input4').zclip({ 
        path: 'js/ZeroClipboard.swf', 
        copy: function(){//复制内容 
            return $('#code4').val(); 
        }, 
        afterCopy: function(){//复制成功 
            $("<span id='msg'/>").insertAfter($('#copy_input')).text('复制成功'); 
        } 
    }); 
}); 
</script>
</head>
<body>
<div class="wrap">
<!-- header begin -->
<div class="header">
    <div ><a href="http://www.siaa.org.cn/"><img src="../logo.png" alt="信息无障碍研究会"  class="logo"/></a></div>
    <!-- nav bar begin -->
    <div class="nav-bar">
        <!-- nav menu begin -->
        <ul>
            <li><a href="../index.html">首页</a></li>
            <li><a href="../index.html">返回</a></li>
        </ul>
        <!-- nav menu end -->
    </div>
    <!-- nav bar end -->
</div>
<!-- header end -->

<!-- body begin -->
<div class="body">
    <h3>用内容描述属性给标准的评分条添加说明和星级提示____20160523</h3>
    <hr />
    <div>
        <h4>【问题描述】</h4>
        <hr />
        <p>Android系统的标准的星级评分条(RatingBar)在默认的情况下是没有任何提示，不提示当前选中的星级等（在TalkBack下测试）。但是星级评分条（RatingBar）的这些内容对使用屏幕阅读器的用户是很重要的，没有这些信息用户无法很好的与应用程序进行交互。</p><!--问题说明-->
    </div>
    <div>
        <h4>【问题代码】</h4>
        <hr />
        <p>下面的代码是MainActivity.java中的代码，下面的代码实现当评分条的值改变的时候显示出改变之后的结果到文本中。</p>
        <textarea rows="34" cols="120" aria-label="问题代码" id="code1">
import android.app.Activity;
import android.os.Bundle;
import android.widget.RatingBar;
import android.widget.RatingBar.OnRatingBarChangeListener;
import android.widget.TextView;

public class RatingBarDemo extends Activity {
private TextView result;
	/** Called when the activity is first created. */
	@Override
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.ratingbar);

		final RatingBar rb1 = (RatingBar) findViewById(R.id.ratingBar1);
		final RatingBar rb2 = (RatingBar) findViewById(R.id.ratingBar2);
		final RatingBar rb3 = (RatingBar) findViewById(R.id.ratingBar3);
		result = (TextView) findViewById(R.id.result);
		result.setText(getString(R.string.rating1)+ rb1.getRating() +" " +getString(R.string.rating2) + rb2.getRating() + " " +getString(R.string.rating3) + rb3.getRating());

		OnRatingBarChangeListener orbcl = new OnRatingBarChangeListener() {
			public void onRatingChanged(RatingBar ratingBar, float rating, boolean fromUser) {
			//把改变之后的评分结果显示出来
				result.setText(getString(R.string.rating1)+ rb1.getRating() +" " +getString(R.string.rating2) + rb2.getRating() + " " +getString(R.string.rating3) + rb3.getRating());
			}

		};

		// 绑定监听器
		rb1.setOnRatingBarChangeListener(orbcl);
		rb2.setOnRatingBarChangeListener(orbcl);
		rb3.setOnRatingBarChangeListener(orbcl);
	}
}
  </textarea><br/>
        <a href="#" id="copy_input1" class="copy">复制内容</a> 
		<p>下面的代码是MainActivity.xml布局文件的代码，在此代码中定义了3个星级评分条(RatingBar)</p>
<textarea rows="40" cols="120" aria-label="问题代码" id="code3">
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout 
xmlns:android="http://schemas.android.com/apk/res/android"
	android:orientation="vertical" 
	android:layout_width="fill_parent"
	android:layout_height="fill_parent">

<TextView
	android:layout_width="match_parent"
	android:layout_height="wrap_content"
	android:id="@+id/result"
	android:text="评分结果"/>

<RatingBar 
	android:id="@+id/ratingBar1"
	android:layout_width="wrap_content"
	android:layout_height="wrap_content" 
	android:rating="3"
	android:stepSize="1">
	</RatingBar>

<RatingBar 
	android:id="@+id/ratingBar2" 
	android:layout_width="wrap_content"
	android:layout_height="wrap_content" 
	android:numStars="5"
	android:rating="4"
	android:isIndicator="false" 
	style="?android:attr/ratingBarStyleIndicator"
	android:layout_marginTop="20dp"
	android:stepSize="1">
</RatingBar>

<RatingBar 
		android:id="@+id/ratingBar3" 
		android:layout_width="wrap_content" 
		android:numStars="10"
       	android:rating="8"
		android:isIndicator="false" 
		style="?android:attr/ratingBarStyleSmall"
		android:layout_marginTop="20dp"
		android:layout_height="wrap_content"
		android:stepSize="1">
</RatingBar>
</LinearLayout>

        </textarea><br/>
        <a href="#" id="copy_input3" class="copy">复制内容</a> 
    </div>
    <div>
        <h4>【问题解决方案描述】</h4>
        <hr />
        <p>用内容描述(android:contentDescription)属性来介绍此评分条的描述和评分条当前的值。
注：此方法并不是一个符合android无障碍理念的方法，只是暂时没有找到正确且符合Android无障碍的方法，所以才用此方法。
</p>
    </div>
    <div>
        <h4>【解决方案】</h4>
        <hr />
		<p>下面是MainActivity.java中的代码，在此代码中利用setContentDescription()方法为评分条设置替代文本。
</p>
        <textarea rows="41" cols="120" aria-label="解决方案代码" id="code2">
import android.app.Activity;
import android.os.Bundle;
import android.widget.RatingBar;
import android.widget.RatingBar.OnRatingBarChangeListener;
import android.widget.TextView;

public class RatingBarDemo extends Activity {
private TextView result;
	/** Called when the activity is first created. */
	@Override
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.ratingbar);

		final RatingBar rb1 = (RatingBar) findViewById(R.id.ratingBar1);
		final RatingBar rb2 = (RatingBar) findViewById(R.id.ratingBar2);
		final RatingBar rb3 = (RatingBar) findViewById(R.id.ratingBar3);
		result = (TextView) findViewById(R.id.result);
		result.setText(getString(R.string.rating1)+ rb1.getRating() +" " +getString(R.string.rating2) + rb2.getRating() + " " +getString(R.string.rating3) + rb3.getRating());
		//利用setcontentDescription()方法设置评分条的替代文本，注意：要加上评分条的当前值
		rb1.setContentDescription(getString(R.string.rating1)+" "+ rb1.getRating());
		rb2.setContentDescription(getString(R.string.rating2)+" "+rb2.getRating());
		rb3.setContentDescription(getString(R.string.rating3)+" " +rb3.getRating());

		OnRatingBarChangeListener orbcl = new OnRatingBarChangeListener() {
			public void onRatingChanged(RatingBar ratingBar, float rating, boolean fromUser) {
			//把改变之后的评分结果显示出来
					result.setText(getString(R.string.rating1)+ rb1.getRating() +" " +getString(R.string.rating2) + rb2.getRating() + " " +getString(R.string.rating3) + rb3.getRating());
			//当评分条的值改变的时候替代文本中的值随之改变
			rb1.setContentDescription(getString(R.string.rating1)+" "+ rb1.getRating());
			rb2.setContentDescription(getString(R.string.rating2)+" "+ rb2.getRating());
			rb3.setContentDescription(getString(R.string.rating3)+" "+ rb3.getRating());
			}

		};

		// 绑定监听器
		rb1.setOnRatingBarChangeListener(orbcl);
		rb2.setOnRatingBarChangeListener(orbcl);
		rb3.setOnRatingBarChangeListener(orbcl);
	}
}
  </textarea><br/>
        <a href="#" id="copy_input2" class="copy">复制内容</a> 
		<p>下面是MainActivity.xml布局文件的代码，下面的代码中每一个评分条都使用android:accessibilityLiveRegion=”assertive”改变了android:accessibilityLiveRegion属性的默认值，这是为了当评分条的替代文本改变的时候能及时朗读出。<br/>
注android:accessibilityLiveRegion属性的值不能设置为polite，设置为此值会导致当改变了评分条的值放开手的时候替代文本会朗读两遍。</p>
		<textarea rows="46" cols="120" aria-label="解决方案代码" id="code4">
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout 
	xmlns:android="http://schemas.android.com/apk/res/android"
	android:orientation="vertical" 
	android:layout_width="fill_parent"
	android:layout_height="fill_parent">

<TextView
	android:layout_width="match_parent"
	android:layout_height="wrap_content"
	android:id="@+id/result"
	android:text="评分结果"/>

<RatingBar 
	android:id="@+id/ratingBar1"
	android:layout_width="wrap_content"
	android:layout_height="wrap_content" 
	android:rating="3"
	android:stepSize="1"
	android:accessibilityLiveRegion="assertive”
	</RatingBar>

<RatingBar 
	android:id="@+id/ratingBar2" 
	android:layout_width="wrap_content"
	android:layout_height="wrap_content" 
	android:numStars="5"
	android:rating="4"
	android:isIndicator="false" 
	style="?android:attr/ratingBarStyleIndicator"
	android:layout_marginTop="20dp"
	android:stepSize="1"
	android:accessibilityLiveRegion="assertive">
</RatingBar>

<RatingBar 
	android:id="@+id/ratingBar3" 
	android:layout_width="wrap_content" 
	android:numStars="10"
	android:rating="8"
	android:isIndicator="false" 
	style="?android:attr/ratingBarStyleSmall"
	android:layout_marginTop="20dp"
	android:accessibilityLiveRegion="assertive"
	android:layout_height="wrap_content"
	android:stepSize="1">
</RatingBar>
</LinearLayout>
        </textarea><br/>
        <a href="#" id="copy_input4" class="copy">复制内容</a> 
    </div>
    <div>
        <h4>【前后效果图对比】</h4>
        <hr />
        <table>
            <tr>
                <td><img src="../images/30-1.png" class="litu" alt="" aria-labelledby="img1_label"/></td><td><img src="../images/30-2.png" class="litu" alt="" aria-labelledby="img2_label"/></td>
            </tr>
            <tr>
                <td id="img1_label">优化前，星级评分条聚焦无朗读；</td><td id="img2_label">优化后，聚焦朗读当前评分值“发货速度 4.0”，双指拖动时朗读改变后的当前评分值”，如“发货速度4.0 ”</td>
            </tr>
        </table>
    </div>
    <div>
        <h4>【扩展】</h4>
        <hr />
        <p></p>
    </div>
    <div>
        <h4>【更多】</h4>
        <hr />
        <ol></ol>
    </div>
</div>
<!-- body end -->

<!-- footer begin -->
<div class="footer">
</div>
<!-- footer end -->
</div>
<!-- wrap end -->
</body>
</html>
